# 使用融云作为消息服务异常检查

第一点：
* 先确认**appkey**文件是否已经生成，文件是**ecology\WEB-INF\prop\EMobileRong.properties**
没有的话需要找**配置部**的同事单独申请**公有云开关补丁包**，文件内容如下：
![后端应用中心](/image/c2/appkey.png "Title")
* 备注：如果没有该文件，可以在客户环境上新建一个，把上述内容写进去，然后客户端登陆验证是否正常发消息，**注意仅供测试**，后续使用还是要**重新申请包**来解决这个问题，千万不能在客户环境上部署使用这个文件，以免**消息出现混乱**。

第二点：
* 上面我们提及公有云是一家叫做**融云**的公司提供，而这个公司提供的服务是部署在很多服务器上的，下面[地址](http://serivcelist.ronghub.com/service.txt)(点击访问)就是融云的**服务器地址列表**，需要把这些地址加入到**网络访问白名单**，就是说不能让**网络设备或者是防火墙**把地址拦截了。

第三点：
* 除了上述地址，还有两个域名是需要访问的，分别是**api.cn.ronghub.com**和**nav.cn.ronghub.com**，访问这两个域名涉及**DNS解析**的问题，如果客户端访问的电脑能够正常访问外网DNS，例如**114.114.114.114**，那这两个域名是可以正常解析的，如果不能配置上述DNS，由于是内网环境，只能配置内网的DNS，那就需要在内网DNS做配置，域名ip一一对应，这个可以在外网上操作：<br/>
`ping api.cn.ronghub.com` <br/>
解析一下这个地址的ip，然后将它配置到DNS里面，实现内网访问。

第四点：
* 上述的网络设置，需要针对安装客户端的电脑，还有服务端电脑，就是oa部署的主机，都得生效，主要原因是客户端需要收发消息，收发消息的过程是需要直接连接上融云的服务器，而服务端需要同步历史消息（这个是指把发送过的消息记录从公有云同步到本地数据库的一个过程），也是需要访问融云的服务器的。

